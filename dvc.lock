schema: '2.0'
stages:
  make_dataset:
    cmd: python3 src/data/make_dataset.py data/external/face-mask-detection/annotations
      data/interim/annotations.csv
    deps:
    - path: data/external/face-mask-detection/annotations
      md5: 3adb0ed65147d9ea49f863bc06b7bdcd.dir
      size: 1576046
      nfiles: 853
    - path: src/data/make_dataset.py
      md5: 0d03c32a5b532ff4b73be024bea43202
      size: 2671
    outs:
    - path: data/interim/annotations.csv
      md5: 23930ef35eae8a5ad4c573a056289310
      size: 200129
  create_crop_dataset:
    cmd: python3 src/data/create_crop_dataset.py data/interim/annotations.csv  data/external/face-mask-detection/images/  data/processed/cropped_images/
    deps:
    - path: data/external/face-mask-detection/images
      md5: 354962b3b72da69dc64ca74fd428a5a7.dir
      size: 416311262
      nfiles: 853
    - path: data/interim/annotations.csv
      md5: 23930ef35eae8a5ad4c573a056289310
      size: 200129
    - path: src/data/create_crop_dataset.py
      md5: 50de737db8dfa8aa6c6e3e27a32f58a1
      size: 1384
    outs:
    - path: data/processed/cropped_images
      md5: 8859ced0fc987ff3a43c0e6c2f8ad564.dir
      size: 16469041
      nfiles: 4072
  train_test_split:
    cmd: python3 src/models/train_test_split.py data/processed/unsplit_train_data/
      data/processed/train_data/
    deps:
    - path: data/processed/unsplit_train_data/
      md5: beee1c86fd82d2f306173ee7aa628f47.dir
      size: 187211808
      nfiles: 8167
    - path: src/models/train_test_split.py
      md5: 36a978893ef44198a71e9a62da7f3721
      size: 1866
    outs:
    - path: data/processed/train_data/
      md5: 076ecc98d30676ab98a433dc1325ed99.dir
      size: 188164600
      nfiles: 8167
  train_model:
    cmd: python3 src/models/train.py data/processed/train_data_external/ 'external'
      src/models/configs/nn_config.yaml models/nn_model_external/
    deps:
    - path: data/processed/train_data_external/
      md5: a474f8ac6f51dd8e7e19f0a073a7be3c.dir
      size: 16525678
      nfiles: 4071
    - path: src/models/configs/nn_config.yaml
      md5: dbe59f98a5b38a77e3c1684a4e0c6dc8
      size: 126
    - path: src/models/train.py
      md5: fefd3ecc7f14bbf0b27bd1a255db0b91
      size: 3409
    outs:
    - path: models/nn_model_external/
      md5: b453a57819cf253e80c85b0ccd164e6d.dir
      size: 94384459
      nfiles: 6
  validate_model:
    cmd: python3 src/models/validate.py  models/nn_model_external/data/model.pth data/processed/train_data_external/val
      'external' src/models/configs/nn_config.yaml
    deps:
    - path: data/processed/train_data_external/val
      md5: e1f6ecfde6bb560b1771bfcc32ebaecd.dir
      size: 1641713
      nfiles: 407
    - path: models/nn_model_external/data/model.pth
      md5: d7efb352102cb7ee9edb167230404cec
      size: 94383617
    - path: src/models/validate.py
      md5: 308d9294ad7e43494a5afab2ef3d0195
      size: 3043
  merge_datasets:
    cmd: python3 src/data/mix_datasets.py data/raw/raw_data/ data/processed/cropped_images/
      data/processed/unsplit_train_data/
    deps:
    - path: data/processed/cropped_images/
      md5: 8859ced0fc987ff3a43c0e6c2f8ad564.dir
      size: 16469041
      nfiles: 4072
    - path: data/raw/raw_data/
      md5: 086383ff30521a59be47dc3ea9872326.dir
      size: 170742767
      nfiles: 4095
    - path: src/data/mix_datasets.py
      md5: fd9ea985e7232c94c359540caf474d71
      size: 997
    outs:
    - path: data/processed/unsplit_train_data/
      md5: beee1c86fd82d2f306173ee7aa628f47.dir
      size: 187211808
      nfiles: 8167
  download_external_dataset:
    cmd: python3 src/data/download_dataset.py data/external/face-mask-detection
    deps:
    - path: src/data/download_dataset.py
      md5: 5c755cc97c05738ce714630b327c017f
      size: 596
    outs:
    - path: data/external/face-mask-detection
      md5: a9f3f3bdfe2ce374f40ce50d314a5f86.dir
      size: 417887308
      nfiles: 1706
  make_dataset_external:
    cmd: python3 src/data/make_dataset.py data/external/face-mask-detection/annotations
      data/interim/annotations.csv
    deps:
    - path: data/external/face-mask-detection/annotations
      md5: 3adb0ed65147d9ea49f863bc06b7bdcd.dir
      size: 1576046
      nfiles: 853
    - path: src/data/make_dataset.py
      md5: 0d03c32a5b532ff4b73be024bea43202
      size: 2671
    outs:
    - path: data/interim/annotations.csv
      md5: 23930ef35eae8a5ad4c573a056289310
      size: 200129
  create_crop_dataset_external:
    cmd: python3 src/data/create_crop_dataset.py data/interim/annotations.csv  data/external/face-mask-detection/images/  data/processed/cropped_images/
    deps:
    - path: data/external/face-mask-detection/images
      md5: 354962b3b72da69dc64ca74fd428a5a7.dir
      size: 416311262
      nfiles: 853
    - path: data/interim/annotations.csv
      md5: 23930ef35eae8a5ad4c573a056289310
      size: 200129
    - path: src/data/create_crop_dataset.py
      md5: 50de737db8dfa8aa6c6e3e27a32f58a1
      size: 1384
    outs:
    - path: data/processed/cropped_images
      md5: 8859ced0fc987ff3a43c0e6c2f8ad564.dir
      size: 16469041
      nfiles: 4072
  train_test_split@0:
    cmd: python3 src/models/train_test_split.py data/raw/raw_data/ internal data/processed/train_data_internal/
    deps:
    - path: data/raw/raw_data/
      md5: 086383ff30521a59be47dc3ea9872326.dir
      size: 170742767
      nfiles: 4095
    - path: src/models/train_test_split.py
      md5: 7fb8427331372a45f7e50f801d571ceb
      size: 1999
    outs:
    - path: data/processed/train_data_internal/
      md5: b831ffa17b0ccc79cda29c1bdac7500c.dir
      size: 171459485
      nfiles: 4094
  train_test_split@1:
    cmd: python3 src/models/train_test_split.py data/processed/cropped_images/ external
      data/processed/train_data_external/
    deps:
    - path: data/processed/cropped_images/
      md5: 8859ced0fc987ff3a43c0e6c2f8ad564.dir
      size: 16469041
      nfiles: 4072
    - path: src/models/train_test_split.py
      md5: 7fb8427331372a45f7e50f801d571ceb
      size: 1999
    outs:
    - path: data/processed/train_data_external/
      md5: a474f8ac6f51dd8e7e19f0a073a7be3c.dir
      size: 16525678
      nfiles: 4071
  train_test_split@2:
    cmd: python3 src/models/train_test_split.py data/processed/unsplit_train_data/
      both data/processed/train_data_both/
    deps:
    - path: data/processed/unsplit_train_data/
      md5: beee1c86fd82d2f306173ee7aa628f47.dir
      size: 187211808
      nfiles: 8167
    - path: src/models/train_test_split.py
      md5: 7fb8427331372a45f7e50f801d571ceb
      size: 1999
    outs:
    - path: data/processed/train_data_both/
      md5: 4e4acfa81b28cfc5aba60ead4e5a8f33.dir
      size: 198805120
      nfiles: 8167
  train_model@1:
    cmd: python3 src/models/train.py  data/processed/train_data_external/ external
      src/models/configs/nn_config.yaml models/nn_model_external
    deps:
    - path: data/processed/train_data_external/
      md5: a474f8ac6f51dd8e7e19f0a073a7be3c.dir
      size: 16525678
      nfiles: 4071
    - path: src/models/configs/nn_config.yaml
      md5: b7347f4efe2987180643a8a46107b3b9
      size: 126
    - path: src/models/train.py
      md5: fefd3ecc7f14bbf0b27bd1a255db0b91
      size: 3409
    outs:
    - path: models/nn_model_external
      md5: 3bf688afba174f6cfb2125d64bb8c830.dir
      size: 94392651
      nfiles: 6
  validate_model@1:
    cmd: python3 src/models/validate.py  models/nn_model_external/data/model.pth data/processed/train_data_external/val/
      external src/models/configs/nn_config.yaml
    deps:
    - path: data/processed/train_data_external/val/
      md5: e1f6ecfde6bb560b1771bfcc32ebaecd.dir
      size: 1641713
      nfiles: 407
    - path: models/nn_model_external/data/model.pth
      md5: 0d1dc7bd7982124891b41b0111306ca5
      size: 94391809
    - path: src/models/configs/nn_config.yaml
      md5: b7347f4efe2987180643a8a46107b3b9
      size: 126
  train_model@0:
    cmd: python3 src/models/train.py  data/processed/train_data_internal/ internal
      src/models/configs/nn_config.yaml models/nn_model_internal
    deps:
    - path: data/processed/train_data_internal/
      md5: b831ffa17b0ccc79cda29c1bdac7500c.dir
      size: 171459485
      nfiles: 4094
    - path: src/models/configs/nn_config.yaml
      md5: b7347f4efe2987180643a8a46107b3b9
      size: 126
    - path: src/models/train.py
      md5: fefd3ecc7f14bbf0b27bd1a255db0b91
      size: 3409
    outs:
    - path: models/nn_model_internal
      md5: 0ccbe668d8d3136ae3f25bf484538000.dir
      size: 94392651
      nfiles: 6
  validate_model@0:
    cmd: python3 src/models/validate.py  models/nn_model_internal/data/model.pth data/processed/train_data_internal/val/
      internal src/models/configs/nn_config.yaml
    deps:
    - path: data/processed/train_data_internal/val/
      md5: 5e3a559864358fd145f56cf946d3a77d.dir
      size: 16502002
      nfiles: 409
    - path: models/nn_model_internal/data/model.pth
      md5: 01189a1d16be845150806398a31c9fa8
      size: 94391809
    - path: src/models/configs/nn_config.yaml
      md5: b7347f4efe2987180643a8a46107b3b9
      size: 126
  validate_model@2:
    cmd: python3 src/models/validate.py  models/nn_model_external/data/model.pth data/processed/train_data_both/val/
      external src/models/configs/nn_config.yaml
    deps:
    - path: data/processed/train_data_both/val/
      md5: a70680ddfefd9ec595941292ee7080d2.dir
      size: 26059064
      nfiles: 817
    - path: models/nn_model_external/data/model.pth
      md5: 0d1dc7bd7982124891b41b0111306ca5
      size: 94391809
    - path: src/models/configs/nn_config.yaml
      md5: b7347f4efe2987180643a8a46107b3b9
      size: 126
  train_model@2:
    cmd: python3 src/models/train.py  data/processed/train_data_both both src/models/configs/nn_config.yaml
      models/nn_model_both
    deps:
    - path: data/processed/train_data_both
      md5: 4e4acfa81b28cfc5aba60ead4e5a8f33.dir
      size: 198805120
      nfiles: 8167
    - path: src/models/configs/nn_config.yaml
      md5: b7347f4efe2987180643a8a46107b3b9
      size: 126
    - path: src/models/train.py
      md5: fefd3ecc7f14bbf0b27bd1a255db0b91
      size: 3409
    outs:
    - path: models/nn_model_both
      md5: 221110c316d6935574e27950f751eb6d.dir
      size: 94392651
      nfiles: 6
